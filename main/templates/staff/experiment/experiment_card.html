{% load crispy_forms_tags %}

<div class="card">
    <div class="card-header">
        Experiment: <span v-if="loading"><i class="fas fa-spinner fa-spin"></i></span><span v-html="experiment.title"></span>
    </div>

    <div class="card-body">
        <!-- Experiment parameters-->
        <div class = "row">
            <div class="col-md-4 text-md-end">
                <!-- <button class="btn btn-outline-primary btn-sm" type="button" data-toggle="modal" data-target="#setupModalCenter"><i class="fas fa-pen fa-xs"></i></button> <u>Experiment Parameters</u>  -->                      
                <u>Experiment Parameters</u>
            </div>
            <div class="col-md-8">
                
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.title.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-html="experiment.title"></span>
            </div>               
        </div>  
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.experiment_manager.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-html="experiment.experiment_manager"></span>
            </div>               
        </div>                                
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.length_default.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-html="experiment.length_default"></span>
            </div>               
        </div> 
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.school.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-html="experiment.school_full.name"></span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.consent_form_default.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-if="experiment.consent_form_default_full"><a v-bind:href="experiment.consent_form_default_full.pdf_file_url">[[experiment.consent_form_default_full.name]]</a></span>
                <span v-else class="fw-bold text-danger">---</span>
            </div>               
        </div>
        
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.survey.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-if="experiment.survey">Yes</span>
                <span v-else>No</span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.account_default.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-html="experiment.account_default_full.str"></span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.budget_default.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-if="experiment.budget_default_full"><a v-bind:href="'/userInfo/' + experiment.budget_default_full.id">[[experiment.budget_default_full.last_name]], [[experiment.budget_default_full.first_name]]</a></span>
                <span v-else class="fw-bold text-danger">---</span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.experiment_pi.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-if="experiment.experiment_pi_full"><a v-bind:href="'/userInfo/' + experiment.experiment_pi_full.id">[[experiment.experiment_pi_full.last_name]], [[experiment.experiment_pi_full.first_name]]</a></span>
                <span v-else class="fw-bold text-danger">---</span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.invite_to_all.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-if="experiment.invite_to_all">Yes</span>
                <span v-else>No</span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.special_instructions_default.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-if="experiment.special_instructions_default==''">---</span>
                <span v-else>[[experiment.special_instructions_default]]</span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.showUpFee.label}}:
            </div>
            <div class="col-md-8 text-end text-md-start">
                $[[experiment.showUpFee]]
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                Institution(s):
            </div>
            <div class="col-md-8 text-end text-md-start">
                <span v-html="institutions_list"></span>
            </div>               
        </div>
        <div class = "row">
            <div class="col-md-4 text-md-end">
                {{form1.notes.label}}:
            </div>
            <div class="col-md-8">   
                <div class="form-control scrollable" v-html="experiment.notes"></div>                     
            </div>               
        </div>
        <div class = "row row mt-2">
            <div class="col-md-4 text-md-end">
                {{form1.invitationText.label}}:
            </div>
            <div class="col-md-8">                        
                <div class="form-control scrollable" v-html="experiment.invitationText"></div>
            </div>               
        </div>
        <div class = "row row mt-2">
            <div class="col-md-4 text-md-end">
                {{form1.reminderText.label}}:
            </div>
            <div class="col-md-8">                        
                <div class="form-control scrollable" v-html="experiment.reminderText"></div>
            </div>               
        </div>
        <div class = "row mt-2 mb-2">
            <div class="col-md-4 text-md-end">
                    
            </div>
            <div class="col-md-8 text-end text-md-start">      
                <button class="btn btn-outline-primary btn-sm" type="button" v-on:click = "showEditExperiment()">Edit <i class="fas fa-pen fa-xs"></i></button>
            </div>               
        </div>                
        <!-- end experiment parameters -->

        {%include "snippits/recruitmentParametersTable.html"%}

        <div class = "row mt-2 mb-4">
            <div class="col-md-4 text-end">
                    
            </div>
            <div class="col-md-8">                        
                <a href="{%url 'userSearchParameters_id' id %}">Search for available subjects.</a>
            </div>               
        </div>

        <!-- session table -->
        <div class="row">                   
            <div class="col">
                <div class="table-responsive">
                    <table class="table table-hover table-condensed">
                        <caption class="caption-top text-center">
                            <span v-if="sessions_count<=25">
                                Sessions ([[sessions.length]])
                            </span> 
                            <span v-else-if="sessions.length ==sessions_count">
                                Sessions ([[sessions_count]])
                            </span>
                            <span v-else>
                                Sessions (1-25 of [[sessions_count]])
                            </span>
                        </caption>
                        <thead>
                            <th scope="col" class="text-nowrap">
                                Day(s) <button class="btn btn-outline-success btn-sm" type="button" v-on:click = "addSession()"><span v-html="addSessionButtonText"></span></button> 
                                <span v-html="'<br>' + addSessionErrorText" class="text-danger fw-bold"></span> 
                            </th>
                            <th scope="col" class="text-center text-nowrap">
                                Creator
                            </th>
                            <th scope="col" class="text-center text-nowrap">
                                Status
                            </th> 
                            <th scope="col" class="text-center text-nowrap">
                                Invited
                            </th> 
                            <th scope="col" class="text-center text-nowrap">
                            Confirmed
                            </th>
                            <th scope="col" class="text-center text-nowrap">
                                Attended
                            </th>                                                     
                            <th scope="col" class="text-center text-nowrap">
                                Edit
                            </th>
                            <th scope="col" class="text-center text-nowrap">
                                Remove
                            </th>
                        </thead>
                        <tbody id="sessionList">                                
                            <tr v-for="(s,index) in sessions" v-bind:key="s.id">                                                                          
                                <td class="text-nowrap">
                                    <span v-for="(d,index) in s.experiment_session_days">
                                        <div>
                                            <span v-if="d.enable_time">
                                                <span v-html="formatDate(d.date,false)"></span>
                                            </span>
                                            <span v-else>
                                                <span v-html="formatDate(d.date,true)"></span> Anytime
                                            </span>
                                                
                                            <span v-if="checkToday(d.date)"><span v-html="'(Today)'"></span></span>
                                        </div>                                                                                                                                                                             
                                    </span>
                                </td>
                                <td class="text-center text-nowrap">
                                    <span v-if="s.creator"><a v-bind:href="'/userInfo/' + s.creator.id">[[s.creator.last_name]], [[s.creator.first_name]]</a></span>
                                    <span v-else>---</span>
                                </td>
                                <td class="text-center text-nowrap">
                                    <div v-if="s.complete">
                                        <span v-html="'Complete'"></span>
                                    </div>
                                    <div v-else>
                                        <span v-html="'Open'"></span>
                                    </div>
                                    <div v-if="s.canceled">
                                        <span v-html="'Canceled'" class="text-danger"></span>
                                    </div>
                                </td>
                                <td class="text-center text-nowrap">
                                    <div v-for="(d,index) in s.experiment_session_days">
                                        [[d.totalCount]]                                                                  
                                    </div>                                        
                                </td>   
                                <td class="text-center text-nowrap">
                                    <div v-for="(d,index) in s.experiment_session_days">
                                        [[d.confirmedCount]]                                                                
                                    </div>                                        
                                </td>
                                <td class="text-center text-nowrap">
                                    <div v-for="(d,index) in s.experiment_session_days">
                                        [[d.attendedCount]]                                                                  
                                    </div>                                        
                                </td>                            
                                <td class="text-center text-nowrap">                                       
                                    <a  v-bind:href='"/experimentSession/" + s.id'>
                                        Edit <i class="fas fa-edit fa-xs"></i>
                                    </a>                                                                                                                                                            
                                </td>
                                <td class="text-center text-nowrap">                                        
                                    <button class="btn btn-outline-danger btn-sm" 
                                            type="button" v-on:click = "removeSession(s.id)" 
                                            v-bind:disabled="s.allow_delete == false || working">
                                        Delete <i class="fas fa-trash fa-xs"></i>
                                    </button>                                                                                                                                                                    
                                </td>                            
                            </tr>                                                  
                        </tbody>
                        <tfoot>
                            <tr v-if="sessions.length === 0">
                                <td><span v-html="'No Sessions'"></span></td>
                                <td class="text-center"><span v-html="'---'"></span></td>
                                <td class="text-center"><span v-html="'---'"></span></td>
                                <td class="text-center"><span v-html="'---'"></span></td>
                            </tr>                                   
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>  
        
        <div class="row" v-if="sessions_count>25 && sessions.length < sessions_count">
            <div class="col text-center">
                <button class="btn btn-outline-primary btn-sm" 
                        type="button" 
                        v-on:click = "showAllSessions()"
                        v-bind:disabled = "working">
                    Show All [[sessions_count]] Sessions <i class="far fa-eye"></i>
                </button>
            </div>
        </div>
        
    </div>      
</div>